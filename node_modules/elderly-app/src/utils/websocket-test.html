<!doctype html>
<html>

<head>
  <title>WebSocket Test</title>
  <meta charset="utf-8" />
</head>

<body>
  <h1>WebSocket Connection Test</h1>
  <div id="status">正在连接...</div>
  <div id="messages"></div>
  <input type="text" id="messageInput" placeholder="输入消息..." />
  <button onclick="sendMessage()">发送</button>

  <script>
    const ws = new WebSocket("ws://localhost:3001/ws?username=test");
    const statusDiv = document.getElementById("status");
    const messagesDiv = document.getElementById("messages");

    ws.onopen = function () {
      statusDiv.innerHTML = "✅ WebSocket连接成功";
      statusDiv.style.color = "green";
    };

    ws.onmessage = function (event) {
      const message = JSON.parse(event.data);
      messagesDiv.innerHTML +=
        "<div>" + JSON.stringify(message, null, 2) + "</div>";
    };

    ws.onclose = function (event) {
      statusDiv.innerHTML = "❌ WebSocket连接关闭: " + event.code;
      statusDiv.style.color = "red";
    };

    ws.onerror = function (error) {
      statusDiv.innerHTML = "❌ WebSocket错误: " + error;
      statusDiv.style.color = "red";
    };

    function sendMessage() {
      const input = document.getElementById("messageInput");
      if (input.value.trim()) {
        ws.send(
          JSON.stringify({
            type: "message",
            data: {
              content: input.value,
              conversationId: "test",
              receivers: ["admin"],
            },
          })
        );
        input.value = "";
      }
    }
  </script>
</body>

</html>